{# templates/components/ProductSearch.html.twig #}
{# for the Live Component to work, there must be a single root element
(e.g. a <div>) where the attributes are applied to #}

    <div {{ attributes.defaults(stimulus_controller('appear')) }}>
        <div class="barre-recherche-wrapper frostedGlass">
            <label for="recherche">Rechercher:</label>
            <input type="search" data-model="debounce(1000)|query" name="recherche" class="barre-recharche">
        </div>
        <div id="results--{{ this.query }}">
            {# {% if page > 1 %}
            {# ü¶ä #}
            {# Adding a fake "previous page" div is enough to trick the system #}
            {# It must have the same ID than the original page #}
            {# <div class="ProductGrid_page" id="page--{{ page - 1 }}" data-live-ignore="true"></div>

            {% endif %} #}
            {% set lastItem = 0 %}

            <div class="article-container">
                {% for article in this.articles %}
                {# <div id="page--{{ this.page }}"> #}
                    <twig:ArticleComponent article='{{article}}' class="{{ cycle(['', 'alt'], loop.index) }}"
                        id="article--page-{{page}}-{{loop.index}}"></twig:ArticleComponent>

                    {% set lastItem = lastItem + loop.index %}
                    {#
                </div> #}
                {% endfor %}


                {# c'est l√† que la magie op√®re... pr√©voire une petite animation !
                avec le couple balise/id, il y aurait moyen de remplacer dans le DOM l'article "loader" une fois les
                nouvelles infos re√ßues.#}
                {% if this.hasMore %}
                {# <div id="page--{{ this.page + 1 }}"> #}
                    {# {% for i in 1..per_page %} #}
                        <article class="blog-card loading frostedGlass" id="article--{{ page + 1 }}-{{ lastItem }}" {# ü¶Å - The trigger #} {#
                            {% if loop.first %} #} data-appear-target="loader" data-action="appear->live#action"
                            data-live-action-param="more" {# {% endif %} #}>
                            {# üêπ - Loading bar #}
                            {# Animated progress bar shown during page load #}
                            
                        </article>
                    {# {% endfor %} #}
                    {#
                </div> #}
                {% endif %}
                {% if not this.hasMore %}
                <div class="blog-card nomore frostedGlass">
                    {% if not lastItem %}
                        aucun r√©sultat pour votre recherche...
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>