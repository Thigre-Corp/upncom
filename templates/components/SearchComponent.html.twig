{# templates/components/ProductSearch.html.twig #}
{# for the Live Component to work, there must be a single root element
(e.g. a <div>) where the attributes are applied to #}

    <div {{ attributes.defaults(stimulus_controller('appear')) }}>

        <input type="search" data-model="debounce(1000)|query" name="recherche">

        <div id="results--{{ this.query }}">
           {% if page > 1 %}
            {# ü¶ä #}
            {# Adding a fake "previous page" div is enough to trick the system #}
            {# It must have the same ID than the original page #}
            <div class="ProductGrid_page" id="page--{{ page - 1 }}" data-live-ignore="true"></div>

            {% endif %}
            {# <div id="page--{{ page }}"> #}
                <div data-live-ignore="true">
                    {% for article in this.articles %}
                    <twig:ArticleComponent article='{{article}}' class="{{loop.index0}}" id="article--page-{{page}}-{{loop.index0}}" />
                    {% endfor %}
{# c'est l√† que la magie op√®re... pr√©voire une petite animation ! 
avec le couple balise/id, il y aurait moyen de remplacer dans le DOM l'article "loader" une fois les nouvelles infos re√ßues.#}
                {% if this.hasMore %}
                    {% for i in 1..per_page %}
                    <article id="article--{{ page + 1 }}-{{loop.index0}}"
                        {# ü¶Å - The trigger #}
                        {% if loop.first %}
                            data-appear-target="loader"
                            data-action="appear->live#action"
                            data-live-action-param="more"
                        {% endif %}
                    >
                            {# üêπ - Loading bar #}
                            {# Animated progress bar shown during page load #}
                            <span class="ProductGrid_loader"
                                    style="--delay: {{ (loop.index + 1) / per_page }};"></span>
                    </article>
                {% endfor %}
                {% endif %}
                {% if not this.hasMore %}
                <div>
                    <p>Plus d'autres articles en stock !!!</p>
                </div>
                {% endif %}
                </div>
            {# </div> #}
        </div>
    </div>