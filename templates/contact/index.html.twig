{% extends 'base.html.twig' %}

{% block title %}Up'n'Com: Contactez-nous!{% endblock %}

{% block body %}


<div>
    <div class="height" style="height: 250px; background-color: #000">
        void
    </div>
    <h1>Contactez-nous !!!</h1>
    <div class="contactContainer">
        <div class="contactMap">
            <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d2682.6069580761!2d7.349902599999998!3d47.7502803!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x47919b552dd92e0f%3A0xb27c5dc416b2e7a5!2sUp&#39;n&#39;Com%20-%20Sophie%20GRELL%20WIRTZ!5e0!3m2!1sfr!2sfr!4v1759993943813!5m2!1sfr!2sfr" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
        </div>
        <div class="contactForm">
            {{ form_start(form )}}
            {{ form_end(form) }}
        </div>
        <div class="contactCoordonnees">
            <h3>Notre agence de Mulhouse:</h3>
            <p>33 rue du Nordfeld</p>
            <p>68100 MULHOUSE</p>
            <tel>06 10 03 27 99</tel>
        </div>
    </div>
</div>

<script>
/*****************constantes ******************************/
    const apiURL = 'https://geo.api.gouv.fr/communes?codePostal=';
    const format = '&format=json';

    const cp = document.getElementById("contact_cp");
    const select = document.getElementById("contact_ville");

   

    cp.addEventListener('input', (e)=>{
       let inputCP = e.target.value;
        if(inputCP.length > 4){
            let url= apiURL+inputCP+format;
            callAPI(url);
            
        }
    });
    
function callAPI(url){
    return fetch(url)
            .then (response => response.json())
            .then (data => {
                let ville = [];
                for(let i=0; i<data.length;i++){
                    console.log('looping');
                    var option = document.createElement('option');
                    option.text = data[i].nom;
                    ville.push(data[i].nom);
                    select.add(option);
                }
                /*sendToBack(ville);*/
            })
            .catch(()=> { console.error("fetch error !") })
        }

{# 
/* plus nÃ©cessaire -------        
function sendToBack(data){
    console.log('data:');
    console.log(data);
    fetch("{{ path('app_city_update') }}", {
        method: 'POST',
        headers: {
        "Content-Type": "application/json",
        }, 
        body: JSON.stringify(data),
        })
    .then (response => console.log(response.json()))

    .catch(()=> {console.error("Nettoyer par AJAX")});
    } 
*/
#}

</script>

{% endblock %}
